openapi: 3.1.0
info:
  title: ForgeConfig API
  description: ForgeConfig — REST API for managing network device provisioning, configuration, backups, IPAM, and more.
  version: 0.2.0
  license:
    name: MIT

servers:
  - url: http://localhost:8080
    description: Local development server

security:
  - bearerAuth: []

tags:
  - name: Auth
    description: Authentication
  - name: Devices
    description: Device CRUD and operations
  - name: Device Variables
    description: Per-device key-value variables
  - name: Port Assignments
    description: Per-port configuration on devices
  - name: Groups
    description: Hierarchical device groups with variable inheritance
  - name: Templates
    description: Configuration template management
  - name: Vendors
    description: Vendor profiles and actions
  - name: Device Models
    description: Hardware model definitions with port layouts
  - name: Device Roles
    description: Role-based template assignment
  - name: Topologies
    description: CLOS fabric topology management
  - name: DHCP Options
    description: DHCP option configuration
  - name: Backups
    description: Device configuration backups
  - name: Discovery
    description: Automatic device discovery via DHCP
  - name: Jobs
    description: Async job queue
  - name: Job Templates
    description: Reusable job definitions with scheduling
  - name: Credentials
    description: SSH and API key credential storage
  - name: Output Parsers
    description: Regex-based output extraction
  - name: Docker
    description: Test container and CLOS lab management
  - name: IPAM
    description: IP Address Management
  - name: Locations
    description: Physical location hierarchy (regions, campuses, datacenters, halls, rows, racks)
  - name: NetBox
    description: NetBox integration and sync
  - name: Users
    description: User management
  - name: Settings
    description: Global server settings and branding
  - name: Benchmarks
    description: Performance benchmarks

paths:
  # ── Health ───────────────────────────────────────────────────────
  /api/health:
    get:
      tags: [Settings]
      summary: Health check
      security: []
      responses:
        "200":
          description: Server is healthy
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MessageResponse"

  # ── Auth ────────────────────────────────────────────────────────
  /api/auth/login:
    post:
      tags: [Auth]
      summary: Login
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: JWT token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"

  # ── Devices ─────────────────────────────────────────────────────
  /api/devices:
    get:
      tags: [Devices]
      summary: List devices
      parameters:
        - $ref: "#/components/parameters/Limit"
        - $ref: "#/components/parameters/Offset"
      responses:
        "200":
          description: Array of devices
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Device"
    post:
      tags: [Devices]
      summary: Create device
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateDeviceRequest"
      responses:
        "201":
          description: Created device
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Device"
        "409":
          $ref: "#/components/responses/Conflict"

  /api/devices/next-hostname:
    get:
      tags: [Devices]
      summary: Generate next hostname from pattern
      description: |
        Uses the global hostname_pattern setting to generate the next available hostname.
        Replaces $datacenter, $role, and # (auto-incrementing number) in the pattern.
      parameters:
        - name: role
          in: query
          required: true
          schema:
            type: string
          description: Device role (e.g. spine, leaf, external)
        - name: datacenter
          in: query
          schema:
            type: string
          description: Datacenter identifier
      responses:
        "200":
          description: Generated hostname
          content:
            application/json:
              schema:
                type: object
                required: [hostname]
                properties:
                  hostname:
                    type: string

  /api/devices/{id}:
    parameters:
      - $ref: "#/components/parameters/DeviceId"
    get:
      tags: [Devices]
      summary: Get device
      responses:
        "200":
          description: Device details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Device"
        "404":
          $ref: "#/components/responses/NotFound"
    put:
      tags: [Devices]
      summary: Update device
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateDeviceRequest"
      responses:
        "200":
          description: Updated device
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Device"
        "404":
          $ref: "#/components/responses/NotFound"
    delete:
      tags: [Devices]
      summary: Delete device
      responses:
        "204":
          description: Deleted
        "404":
          $ref: "#/components/responses/NotFound"

  /api/devices/{id}/connect:
    parameters:
      - $ref: "#/components/parameters/DeviceId"
    post:
      tags: [Devices]
      summary: Test SSH connectivity to device
      responses:
        "200":
          description: Connectivity result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConnectResult"

  /api/connect:
    post:
      tags: [Devices]
      summary: Test connectivity to arbitrary IP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ConnectIpRequest"
      responses:
        "200":
          description: Connectivity result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConnectResult"

  /api/devices/{id}/config:
    parameters:
      - $ref: "#/components/parameters/DeviceId"
    get:
      tags: [Devices]
      summary: Get rendered configuration
      responses:
        "200":
          description: Rendered config
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeviceConfigResponse"

  /api/devices/{id}/preview-config:
    parameters:
      - $ref: "#/components/parameters/DeviceId"
    post:
      tags: [Devices]
      summary: Preview config with variables
      responses:
        "200":
          description: Config preview
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeviceConfigPreviewResponse"

  /api/devices/{id}/deploy-config:
    parameters:
      - $ref: "#/components/parameters/DeviceId"
    post:
      tags: [Devices]
      summary: Deploy config to device over SSH
      responses:
        "202":
          description: Deploy job accepted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Job"

  /api/devices/{id}/diff-config:
    parameters:
      - $ref: "#/components/parameters/DeviceId"
    post:
      tags: [Devices]
      summary: Diff current running config vs. rendered config
      responses:
        "202":
          description: Diff job accepted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Job"

  /api/devices/{id}/exec:
    parameters:
      - $ref: "#/components/parameters/DeviceId"
    post:
      tags: [Devices]
      summary: Execute command on device
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ExecRequest"
      responses:
        "202":
          description: Exec job accepted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Job"

  # ── Device Variables ────────────────────────────────────────────
  /api/devices/{id}/variables:
    parameters:
      - $ref: "#/components/parameters/DeviceId"
    get:
      tags: [Device Variables]
      summary: List device variables
      responses:
        "200":
          description: Array of variables
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DeviceVariable"
    put:
      tags: [Device Variables]
      summary: Set all device variables (replace)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SetVariablesRequest"
      responses:
        "200":
          description: Updated variables
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DeviceVariable"

  /api/devices/{id}/variables/{key}:
    parameters:
      - $ref: "#/components/parameters/DeviceId"
      - name: key
        in: path
        required: true
        schema:
          type: string
    put:
      tags: [Device Variables]
      summary: Set a single variable
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SetVariableRequest"
      responses:
        "200":
          $ref: "#/components/responses/Message"
    delete:
      tags: [Device Variables]
      summary: Delete a variable
      responses:
        "200":
          $ref: "#/components/responses/Message"

  /api/variables/keys:
    get:
      tags: [Device Variables]
      summary: List all variable keys with device counts
      responses:
        "200":
          description: Array of key info
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/VariableKeyInfo"

  /api/variables/keys/{key}:
    parameters:
      - name: key
        in: path
        required: true
        schema:
          type: string
    delete:
      tags: [Device Variables]
      summary: Delete a key from all devices
      responses:
        "200":
          $ref: "#/components/responses/Message"

  /api/variables/by-key/{key}:
    parameters:
      - name: key
        in: path
        required: true
        schema:
          type: string
    get:
      tags: [Device Variables]
      summary: List all values for a key
      responses:
        "200":
          description: Variables with this key
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DeviceVariable"

  /api/variables/bulk:
    post:
      tags: [Device Variables]
      summary: Bulk set variables across devices
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BulkSetRequest"
      responses:
        "200":
          description: Result
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  count:
                    type: integer

  # ── Port Assignments ────────────────────────────────────────────
  /api/devices/{id}/port-assignments:
    parameters:
      - $ref: "#/components/parameters/DeviceId"
    get:
      tags: [Port Assignments]
      summary: List port assignments for a device
      responses:
        "200":
          description: Array of port assignments
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/PortAssignment"
    put:
      tags: [Port Assignments]
      summary: Bulk set port assignments (replace all)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/SetPortAssignmentRequest"
      responses:
        "200":
          $ref: "#/components/responses/Message"

  /api/devices/{id}/port-assignments/{port_name}:
    parameters:
      - $ref: "#/components/parameters/DeviceId"
      - name: port_name
        in: path
        required: true
        schema:
          type: string
    put:
      tags: [Port Assignments]
      summary: Set a single port assignment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SetPortAssignmentRequest"
      responses:
        "200":
          $ref: "#/components/responses/Message"
    delete:
      tags: [Port Assignments]
      summary: Delete a port assignment
      responses:
        "200":
          $ref: "#/components/responses/Message"

  # ── Groups ──────────────────────────────────────────────────────
  /api/groups:
    get:
      tags: [Groups]
      summary: List groups
      responses:
        "200":
          description: Array of groups
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Group"
    post:
      tags: [Groups]
      summary: Create group
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateGroupRequest"
      responses:
        "201":
          description: Created group
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Group"

  /api/groups/{id}:
    parameters:
      - $ref: "#/components/parameters/IntId"
    get:
      tags: [Groups]
      summary: Get group
      responses:
        "200":
          description: Group details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Group"
    put:
      tags: [Groups]
      summary: Update group
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateGroupRequest"
      responses:
        "200":
          description: Updated group
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Group"
    delete:
      tags: [Groups]
      summary: Delete group
      responses:
        "200":
          $ref: "#/components/responses/Message"

  /api/groups/{id}/variables:
    parameters:
      - $ref: "#/components/parameters/IntId"
    get:
      tags: [Groups]
      summary: List group variables
      responses:
        "200":
          description: Array of group variables
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/GroupVariable"

  /api/groups/{id}/variables/{key}:
    parameters:
      - $ref: "#/components/parameters/IntId"
      - name: key
        in: path
        required: true
        schema:
          type: string
    put:
      tags: [Groups]
      summary: Set group variable
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SetVariableRequest"
      responses:
        "200":
          $ref: "#/components/responses/Message"
    delete:
      tags: [Groups]
      summary: Delete group variable
      responses:
        "200":
          $ref: "#/components/responses/Message"

  /api/groups/{id}/members:
    parameters:
      - $ref: "#/components/parameters/IntId"
    get:
      tags: [Groups]
      summary: List group members
      responses:
        "200":
          description: Array of device IDs
          content:
            application/json:
              schema:
                type: array
                items:
                  type: integer
                  format: int64
    put:
      tags: [Groups]
      summary: Set all group members (replace)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SetMembersRequest"
      responses:
        "200":
          $ref: "#/components/responses/Message"

  /api/groups/{id}/members/{device_id}:
    parameters:
      - $ref: "#/components/parameters/IntId"
      - $ref: "#/components/parameters/DeviceId"
    put:
      tags: [Groups]
      summary: Add member to group
      responses:
        "200":
          $ref: "#/components/responses/Message"
    delete:
      tags: [Groups]
      summary: Remove member from group
      responses:
        "200":
          $ref: "#/components/responses/Message"

  /api/devices/{id}/groups:
    parameters:
      - $ref: "#/components/parameters/DeviceId"
    get:
      tags: [Groups]
      summary: List groups for a device
      responses:
        "200":
          description: Groups the device belongs to
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Group"
    put:
      tags: [Groups]
      summary: Set groups for a device (replace)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SetDeviceGroupsRequest"
      responses:
        "200":
          $ref: "#/components/responses/Message"

  /api/devices/{id}/resolved-variables:
    parameters:
      - $ref: "#/components/parameters/DeviceId"
    get:
      tags: [Groups]
      summary: Get resolved variables with inheritance
      responses:
        "200":
          description: Resolved variables with full resolution order
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResolvedVariablesResponse"

  # ── Templates ───────────────────────────────────────────────────
  /api/templates:
    get:
      tags: [Templates]
      summary: List templates
      responses:
        "200":
          description: Array of templates
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Template"
    post:
      tags: [Templates]
      summary: Create template
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTemplateRequest"
      responses:
        "201":
          description: Created template
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Template"

  /api/templates/_/variables:
    get:
      tags: [Templates]
      summary: List built-in template variables
      responses:
        "200":
          description: Variable definitions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TemplateVariable"

  /api/templates/{id}:
    parameters:
      - $ref: "#/components/parameters/Id"
    get:
      tags: [Templates]
      summary: Get template
      responses:
        "200":
          description: Template details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Template"
    put:
      tags: [Templates]
      summary: Update template
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTemplateRequest"
      responses:
        "200":
          description: Updated template
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Template"
    delete:
      tags: [Templates]
      summary: Delete template
      responses:
        "204":
          description: Deleted

  /api/templates/{id}/preview:
    parameters:
      - $ref: "#/components/parameters/Id"
    post:
      tags: [Templates]
      summary: Preview rendered template
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TemplatePreviewRequest"
      responses:
        "200":
          description: Rendered output
          content:
            application/json:
              schema:
                type: object
                properties:
                  output:
                    type: string

  # ── Vendors ─────────────────────────────────────────────────────
  /api/vendors:
    get:
      tags: [Vendors]
      summary: List vendors
      responses:
        "200":
          description: Array of vendors
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Vendor"
    post:
      tags: [Vendors]
      summary: Create vendor
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateVendorRequest"
      responses:
        "201":
          description: Created vendor
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Vendor"

  /api/vendors/defaults:
    get:
      tags: [Vendors]
      summary: Get built-in default vendors
      responses:
        "200":
          description: Default vendor definitions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Vendor"

  /api/vendors/{id}:
    parameters:
      - $ref: "#/components/parameters/Id"
    get:
      tags: [Vendors]
      summary: Get vendor
      responses:
        "200":
          description: Vendor details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Vendor"
    put:
      tags: [Vendors]
      summary: Update vendor
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateVendorRequest"
      responses:
        "200":
          description: Updated vendor
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Vendor"
    delete:
      tags: [Vendors]
      summary: Delete vendor
      responses:
        "204":
          description: Deleted

  /api/vendors/{id}/actions:
    parameters:
      - $ref: "#/components/parameters/Id"
    get:
      tags: [Vendors]
      summary: List actions for a vendor
      responses:
        "200":
          description: Vendor actions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/VendorAction"

  /api/vendor-actions:
    get:
      tags: [Vendors]
      summary: List all vendor actions
      responses:
        "200":
          description: All vendor actions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/VendorAction"
    post:
      tags: [Vendors]
      summary: Create vendor action
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateVendorActionRequest"
      responses:
        "201":
          description: Created action
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/VendorAction"

  /api/vendor-actions/{id}:
    parameters:
      - $ref: "#/components/parameters/Id"
    put:
      tags: [Vendors]
      summary: Update vendor action
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateVendorActionRequest"
      responses:
        "200":
          description: Updated action
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/VendorAction"
    delete:
      tags: [Vendors]
      summary: Delete vendor action
      responses:
        "204":
          description: Deleted

  /api/vendor-actions/{id}/run:
    parameters:
      - $ref: "#/components/parameters/Id"
    post:
      tags: [Vendors]
      summary: Execute vendor action on a device
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [device_id]
              properties:
                device_id:
                  type: integer
                  format: int64
      responses:
        "202":
          description: Job accepted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Job"

  # ── Device Models ───────────────────────────────────────────────
  /api/device-models:
    get:
      tags: [Device Models]
      summary: List device models
      responses:
        "200":
          description: Array of device models
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DeviceModel"
    post:
      tags: [Device Models]
      summary: Create device model
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateDeviceModelRequest"
      responses:
        "201":
          description: Created device model
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeviceModel"

  /api/device-models/{id}:
    parameters:
      - $ref: "#/components/parameters/Id"
    get:
      tags: [Device Models]
      summary: Get device model
      responses:
        "200":
          description: Device model details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeviceModel"
    put:
      tags: [Device Models]
      summary: Update device model
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateDeviceModelRequest"
      responses:
        "200":
          description: Updated device model
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeviceModel"
    delete:
      tags: [Device Models]
      summary: Delete device model
      responses:
        "204":
          description: Deleted

  # ── Device Roles ────────────────────────────────────────────────
  /api/device-roles:
    get:
      tags: [Device Roles]
      summary: List device roles
      responses:
        "200":
          description: Array of device roles
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DeviceRole"
    post:
      tags: [Device Roles]
      summary: Create device role
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateDeviceRoleRequest"
      responses:
        "201":
          description: Created device role
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeviceRole"

  /api/device-roles/{id}:
    parameters:
      - $ref: "#/components/parameters/Id"
    get:
      tags: [Device Roles]
      summary: Get device role
      responses:
        "200":
          description: Device role details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeviceRole"
    put:
      tags: [Device Roles]
      summary: Update device role
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateDeviceRoleRequest"
      responses:
        "200":
          description: Updated device role
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeviceRole"
    delete:
      tags: [Device Roles]
      summary: Delete device role
      responses:
        "204":
          description: Deleted

  # ── Topologies ──────────────────────────────────────────────────
  /api/topologies:
    get:
      tags: [Topologies]
      summary: List topologies
      responses:
        "200":
          description: Array of topologies
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Topology"
    post:
      tags: [Topologies]
      summary: Create topology
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTopologyRequest"
      responses:
        "201":
          description: Created topology
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Topology"

  /api/topologies/{id}:
    parameters:
      - $ref: "#/components/parameters/Id"
    get:
      tags: [Topologies]
      summary: Get topology
      responses:
        "200":
          description: Topology details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Topology"
    put:
      tags: [Topologies]
      summary: Update topology
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTopologyRequest"
      responses:
        "200":
          description: Updated topology
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Topology"
    delete:
      tags: [Topologies]
      summary: Delete topology
      responses:
        "204":
          description: Deleted

  # ── DHCP Options ────────────────────────────────────────────────
  /api/dhcp-options:
    get:
      tags: [DHCP Options]
      summary: List DHCP options
      responses:
        "200":
          description: Array of DHCP options
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DhcpOption"
    post:
      tags: [DHCP Options]
      summary: Create DHCP option
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateDhcpOptionRequest"
      responses:
        "201":
          description: Created DHCP option
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DhcpOption"

  /api/dhcp-options/defaults:
    get:
      tags: [DHCP Options]
      summary: Get default DHCP options
      responses:
        "200":
          description: Default options
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DhcpOption"

  /api/dhcp-options/{id}:
    parameters:
      - $ref: "#/components/parameters/Id"
    get:
      tags: [DHCP Options]
      summary: Get DHCP option
      responses:
        "200":
          description: DHCP option details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DhcpOption"
    put:
      tags: [DHCP Options]
      summary: Update DHCP option
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateDhcpOptionRequest"
      responses:
        "200":
          description: Updated DHCP option
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DhcpOption"
    delete:
      tags: [DHCP Options]
      summary: Delete DHCP option
      responses:
        "204":
          description: Deleted

  # ── Backups ─────────────────────────────────────────────────────
  /api/devices/{id}/backup:
    parameters:
      - $ref: "#/components/parameters/DeviceId"
    post:
      tags: [Backups]
      summary: Trigger manual backup
      responses:
        "202":
          description: Backup triggered
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MessageResponse"

  /api/devices/{id}/backups:
    parameters:
      - $ref: "#/components/parameters/DeviceId"
    get:
      tags: [Backups]
      summary: List backups for device
      responses:
        "200":
          description: Array of backups
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Backup"

  /api/backups/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
    get:
      tags: [Backups]
      summary: Get backup with content
      responses:
        "200":
          description: Backup details with content
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BackupWithContent"

  # ── Discovery ───────────────────────────────────────────────────
  /api/discovery:
    get:
      tags: [Discovery]
      summary: List undiscovered devices
      responses:
        "200":
          description: Discovered but un-provisioned devices
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DiscoveredDevice"

  /api/discovery/leases:
    get:
      tags: [Discovery]
      summary: List current DHCP leases
      responses:
        "200":
          description: Active DHCP leases
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DiscoveredDevice"

  /api/discovery/logs:
    get:
      tags: [Discovery]
      summary: List discovery event logs
      parameters:
        - $ref: "#/components/parameters/Limit"
        - $ref: "#/components/parameters/Offset"
      responses:
        "200":
          description: Discovery log entries
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DiscoveryLog"
    delete:
      tags: [Discovery]
      summary: Clear discovery logs
      responses:
        "200":
          $ref: "#/components/responses/Message"

  /api/discovery/clear:
    post:
      tags: [Discovery]
      summary: Clear all discovered devices
      responses:
        "200":
          $ref: "#/components/responses/Message"

  /api/discovery/{mac}:
    parameters:
      - name: mac
        in: path
        required: true
        schema:
          type: string
    delete:
      tags: [Discovery]
      summary: Dismiss a discovered device
      responses:
        "200":
          $ref: "#/components/responses/Message"

  # ── Jobs ────────────────────────────────────────────────────────
  /api/jobs:
    get:
      tags: [Jobs]
      summary: List jobs
      parameters:
        - name: device_id
          in: query
          schema:
            type: integer
            format: int64
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
      responses:
        "200":
          description: Array of jobs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Job"

  /api/jobs/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
    get:
      tags: [Jobs]
      summary: Get job status and output
      responses:
        "200":
          description: Job details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Job"

  # ── Job Templates ───────────────────────────────────────────────
  /api/job-templates:
    get:
      tags: [Job Templates]
      summary: List job templates
      responses:
        "200":
          description: Array of job templates
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/JobTemplate"
    post:
      tags: [Job Templates]
      summary: Create job template
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateJobTemplateRequest"
      responses:
        "201":
          description: Created job template
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JobTemplate"

  /api/job-templates/{id}:
    parameters:
      - $ref: "#/components/parameters/Id"
    get:
      tags: [Job Templates]
      summary: Get job template
      responses:
        "200":
          description: Job template details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JobTemplate"
    put:
      tags: [Job Templates]
      summary: Update job template
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateJobTemplateRequest"
      responses:
        "200":
          description: Updated job template
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JobTemplate"
    delete:
      tags: [Job Templates]
      summary: Delete job template
      responses:
        "204":
          description: Deleted

  /api/job-templates/{id}/run:
    parameters:
      - $ref: "#/components/parameters/Id"
    post:
      tags: [Job Templates]
      summary: Execute job template
      responses:
        "202":
          description: Jobs queued
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Job"

  # ── Credentials ─────────────────────────────────────────────────
  /api/credentials:
    get:
      tags: [Credentials]
      summary: List credentials
      responses:
        "200":
          description: Array of credentials
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Credential"
    post:
      tags: [Credentials]
      summary: Create credential
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateCredentialRequest"
      responses:
        "201":
          description: Created credential
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Credential"

  /api/credentials/{id}:
    parameters:
      - $ref: "#/components/parameters/Id"
    get:
      tags: [Credentials]
      summary: Get credential
      responses:
        "200":
          description: Credential details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Credential"
    put:
      tags: [Credentials]
      summary: Update credential
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateCredentialRequest"
      responses:
        "200":
          description: Updated credential
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Credential"
    delete:
      tags: [Credentials]
      summary: Delete credential
      responses:
        "204":
          description: Deleted

  # ── Output Parsers ──────────────────────────────────────────────
  /api/output-parsers:
    get:
      tags: [Output Parsers]
      summary: List output parsers
      responses:
        "200":
          description: Array of output parsers
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/OutputParser"
    post:
      tags: [Output Parsers]
      summary: Create output parser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateOutputParserRequest"
      responses:
        "201":
          description: Created output parser
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OutputParser"

  /api/output-parsers/{id}:
    parameters:
      - $ref: "#/components/parameters/IntId"
    get:
      tags: [Output Parsers]
      summary: Get output parser
      responses:
        "200":
          description: Output parser details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OutputParser"
    put:
      tags: [Output Parsers]
      summary: Update output parser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateOutputParserRequest"
      responses:
        "200":
          description: Updated output parser
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OutputParser"
    delete:
      tags: [Output Parsers]
      summary: Delete output parser
      responses:
        "204":
          description: Deleted

  # ── Users ───────────────────────────────────────────────────────
  /api/users:
    get:
      tags: [Users]
      summary: List users
      responses:
        "200":
          description: Array of users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/User"
    post:
      tags: [Users]
      summary: Create user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateUserRequest"
      responses:
        "201":
          description: Created user
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"

  /api/users/{id}:
    parameters:
      - $ref: "#/components/parameters/Id"
    get:
      tags: [Users]
      summary: Get user
      responses:
        "200":
          description: User details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
    put:
      tags: [Users]
      summary: Update user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateUserRequest"
      responses:
        "200":
          description: Updated user
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
    delete:
      tags: [Users]
      summary: Delete user
      responses:
        "204":
          description: Deleted

  # ── Docker / Lab ────────────────────────────────────────────────
  /api/docker/containers:
    get:
      tags: [Docker]
      summary: List managed containers
      responses:
        "200":
          description: Array of containers
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TestContainer"
    post:
      tags: [Docker]
      summary: Spawn a test container
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SpawnContainerRequest"
      responses:
        "201":
          description: Spawned container
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TestContainer"

  /api/docker/containers/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
    delete:
      tags: [Docker]
      summary: Remove container
      responses:
        "200":
          $ref: "#/components/responses/Message"

  /api/docker/containers/{id}/start:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
    post:
      tags: [Docker]
      summary: Start container
      responses:
        "200":
          $ref: "#/components/responses/Message"

  /api/docker/containers/{id}/restart:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
    post:
      tags: [Docker]
      summary: Restart container
      responses:
        "200":
          $ref: "#/components/responses/Message"

  /api/docker/clos-lab:
    post:
      tags: [Docker]
      summary: Build a CLOS lab topology with containers
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VirtualClosRequest"
      responses:
        "201":
          description: CLOS lab created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ClosLabResponse"
    delete:
      tags: [Docker]
      summary: Tear down CLOS lab
      responses:
        "200":
          $ref: "#/components/responses/Message"

  /api/virtual-clos:
    post:
      tags: [Docker]
      summary: Build virtual CLOS topology (device records only, no containers)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VirtualClosRequest"
      responses:
        "201":
          description: Virtual CLOS created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ClosLabResponse"
    delete:
      tags: [Docker]
      summary: Tear down virtual CLOS topology
      responses:
        "200":
          $ref: "#/components/responses/Message"

  # ── IPAM ────────────────────────────────────────────────────────
  /api/ipam/roles:
    get:
      tags: [IPAM]
      summary: List roles
      responses:
        "200":
          description: Array of roles
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/IpamRole"
    post:
      tags: [IPAM]
      summary: Create role
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateIpamRoleRequest"
      responses:
        "201":
          description: Created role
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamRole"

  /api/ipam/roles/{id}:
    parameters:
      - $ref: "#/components/parameters/Id"
    delete:
      tags: [IPAM]
      summary: Delete role
      responses:
        "204":
          description: Deleted

  /api/ipam/vrfs:
    get:
      tags: [IPAM]
      summary: List VRFs
      responses:
        "200":
          description: Array of VRFs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/IpamVrf"
    post:
      tags: [IPAM]
      summary: Create VRF
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateIpamVrfRequest"
      responses:
        "201":
          description: Created VRF
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamVrf"

  /api/ipam/vrfs/{id}:
    parameters:
      - $ref: "#/components/parameters/Id"
    delete:
      tags: [IPAM]
      summary: Delete VRF
      responses:
        "204":
          description: Deleted

  /api/ipam/prefixes:
    get:
      tags: [IPAM]
      summary: List prefixes
      responses:
        "200":
          description: Array of prefixes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/IpamPrefix"
    post:
      tags: [IPAM]
      summary: Create prefix
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateIpamPrefixRequest"
      responses:
        "201":
          description: Created prefix
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamPrefix"

  /api/ipam/prefixes/supernets:
    get:
      tags: [IPAM]
      summary: List supernets
      responses:
        "200":
          description: Supernet prefixes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/IpamPrefix"

  /api/ipam/prefixes/{id}:
    parameters:
      - $ref: "#/components/parameters/Id"
    get:
      tags: [IPAM]
      summary: Get prefix
      responses:
        "200":
          description: Prefix details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamPrefix"
    put:
      tags: [IPAM]
      summary: Update prefix
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateIpamPrefixRequest"
      responses:
        "200":
          description: Updated prefix
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamPrefix"
    delete:
      tags: [IPAM]
      summary: Delete prefix
      responses:
        "204":
          description: Deleted

  /api/ipam/prefixes/{id}/available-prefixes:
    parameters:
      - $ref: "#/components/parameters/Id"
    post:
      tags: [IPAM]
      summary: Get next available child prefix
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [prefix_length]
              properties:
                prefix_length:
                  type: integer
                description:
                  type: string
                status:
                  $ref: "#/components/schemas/IpamStatus"
      responses:
        "201":
          description: Allocated prefix
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamPrefix"

  /api/ipam/prefixes/{id}/available-ips:
    parameters:
      - $ref: "#/components/parameters/Id"
    post:
      tags: [IPAM]
      summary: Get next available IP address
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                description:
                  type: string
                status:
                  $ref: "#/components/schemas/IpamStatus"
                dns_name:
                  type: string
      responses:
        "201":
          description: Allocated IP address
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamIpAddress"

  /api/ipam/ip-addresses:
    get:
      tags: [IPAM]
      summary: List IP addresses
      responses:
        "200":
          description: Array of IP addresses
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/IpamIpAddress"
    post:
      tags: [IPAM]
      summary: Create IP address
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateIpamIpAddressRequest"
      responses:
        "201":
          description: Created IP address
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamIpAddress"

  /api/ipam/ip-addresses/{id}:
    parameters:
      - $ref: "#/components/parameters/Id"
    get:
      tags: [IPAM]
      summary: Get IP address
      responses:
        "200":
          description: IP address details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamIpAddress"
    put:
      tags: [IPAM]
      summary: Update IP address
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateIpamIpAddressRequest"
      responses:
        "200":
          description: Updated IP address
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamIpAddress"
    delete:
      tags: [IPAM]
      summary: Delete IP address
      responses:
        "204":
          description: Deleted

  /api/ipam/tags/keys:
    get:
      tags: [IPAM]
      summary: List all tag keys in use
      responses:
        "200":
          description: Array of tag key strings
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string

  /api/ipam/tags/{resource_type}/{resource_id}:
    parameters:
      - name: resource_type
        in: path
        required: true
        schema:
          type: string
      - name: resource_id
        in: path
        required: true
        schema:
          type: string
    get:
      tags: [IPAM]
      summary: List tags for a resource
      responses:
        "200":
          description: Tags
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/IpamTag"
    post:
      tags: [IPAM]
      summary: Set tag on a resource
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [key, value]
              properties:
                key:
                  type: string
                value:
                  type: string
      responses:
        "200":
          $ref: "#/components/responses/Message"

  /api/ipam/tags/{resource_type}/{resource_id}/{key}:
    parameters:
      - name: resource_type
        in: path
        required: true
        schema:
          type: string
      - name: resource_id
        in: path
        required: true
        schema:
          type: string
      - name: key
        in: path
        required: true
        schema:
          type: string
    delete:
      tags: [IPAM]
      summary: Delete tag
      responses:
        "200":
          $ref: "#/components/responses/Message"

  # ── Locations ───────────────────────────────────────────────────
  /api/ipam/regions:
    get:
      tags: [Locations]
      summary: List regions
      responses:
        "200":
          description: Array of regions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/IpamRegion"
    post:
      tags: [Locations]
      summary: Create region
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateIpamRegionRequest"
      responses:
        "201":
          description: Created region
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamRegion"

  /api/ipam/regions/{id}:
    parameters:
      - $ref: "#/components/parameters/Id"
    get:
      tags: [Locations]
      summary: Get region
      responses:
        "200":
          description: Region details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamRegion"
    put:
      tags: [Locations]
      summary: Update region
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateIpamRegionRequest"
      responses:
        "200":
          description: Updated region
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamRegion"
    delete:
      tags: [Locations]
      summary: Delete region
      responses:
        "204":
          description: Deleted

  /api/ipam/campuses:
    get:
      tags: [Locations]
      summary: List campuses
      responses:
        "200":
          description: Array of campuses
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/IpamCampus"
    post:
      tags: [Locations]
      summary: Create campus
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateIpamCampusRequest"
      responses:
        "201":
          description: Created campus
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamCampus"

  /api/ipam/campuses/{id}:
    parameters:
      - $ref: "#/components/parameters/Id"
    get:
      tags: [Locations]
      summary: Get campus
      responses:
        "200":
          description: Campus details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamCampus"
    put:
      tags: [Locations]
      summary: Update campus
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateIpamCampusRequest"
      responses:
        "200":
          description: Updated campus
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamCampus"
    delete:
      tags: [Locations]
      summary: Delete campus
      responses:
        "204":
          description: Deleted

  /api/ipam/datacenters:
    get:
      tags: [Locations]
      summary: List datacenters
      responses:
        "200":
          description: Array of datacenters
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/IpamDatacenter"
    post:
      tags: [Locations]
      summary: Create datacenter
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateIpamDatacenterRequest"
      responses:
        "201":
          description: Created datacenter
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamDatacenter"

  /api/ipam/datacenters/{id}:
    parameters:
      - $ref: "#/components/parameters/Id"
    get:
      tags: [Locations]
      summary: Get datacenter
      responses:
        "200":
          description: Datacenter details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamDatacenter"
    put:
      tags: [Locations]
      summary: Update datacenter
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateIpamDatacenterRequest"
      responses:
        "200":
          description: Updated datacenter
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamDatacenter"
    delete:
      tags: [Locations]
      summary: Delete datacenter
      responses:
        "204":
          description: Deleted

  /api/ipam/halls:
    get:
      tags: [Locations]
      summary: List halls
      responses:
        "200":
          description: Array of halls
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/IpamHall"
    post:
      tags: [Locations]
      summary: Create hall
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateIpamHallRequest"
      responses:
        "201":
          description: Created hall
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamHall"

  /api/ipam/halls/{id}:
    parameters:
      - $ref: "#/components/parameters/Id"
    get:
      tags: [Locations]
      summary: Get hall
      responses:
        "200":
          description: Hall details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamHall"
    put:
      tags: [Locations]
      summary: Update hall
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateIpamHallRequest"
      responses:
        "200":
          description: Updated hall
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamHall"
    delete:
      tags: [Locations]
      summary: Delete hall
      responses:
        "204":
          description: Deleted

  /api/ipam/rows:
    get:
      tags: [Locations]
      summary: List rows
      responses:
        "200":
          description: Array of rows
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/IpamRow"
    post:
      tags: [Locations]
      summary: Create row
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateIpamRowRequest"
      responses:
        "201":
          description: Created row
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamRow"

  /api/ipam/rows/{id}:
    parameters:
      - $ref: "#/components/parameters/Id"
    get:
      tags: [Locations]
      summary: Get row
      responses:
        "200":
          description: Row details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamRow"
    put:
      tags: [Locations]
      summary: Update row
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateIpamRowRequest"
      responses:
        "200":
          description: Updated row
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamRow"
    delete:
      tags: [Locations]
      summary: Delete row
      responses:
        "204":
          description: Deleted

  /api/ipam/racks:
    get:
      tags: [Locations]
      summary: List racks
      responses:
        "200":
          description: Array of racks
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/IpamRack"
    post:
      tags: [Locations]
      summary: Create rack
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateIpamRackRequest"
      responses:
        "201":
          description: Created rack
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamRack"

  /api/ipam/racks/{id}:
    parameters:
      - $ref: "#/components/parameters/Id"
    get:
      tags: [Locations]
      summary: Get rack
      responses:
        "200":
          description: Rack details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamRack"
    put:
      tags: [Locations]
      summary: Update rack
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateIpamRackRequest"
      responses:
        "200":
          description: Updated rack
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpamRack"
    delete:
      tags: [Locations]
      summary: Delete rack
      responses:
        "204":
          description: Deleted

  # ── NetBox ──────────────────────────────────────────────────────
  /api/netbox/status:
    get:
      tags: [NetBox]
      summary: Check NetBox connectivity
      responses:
        "200":
          description: Connection status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NetBoxStatus"

  /api/netbox/config:
    get:
      tags: [NetBox]
      summary: Get NetBox configuration
      responses:
        "200":
          description: NetBox config
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NetBoxConfig"
    put:
      tags: [NetBox]
      summary: Update NetBox configuration
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NetBoxConfig"
      responses:
        "200":
          description: Updated config
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NetBoxConfig"

  /api/netbox/sync/push:
    post:
      tags: [NetBox]
      summary: Push devices to NetBox
      responses:
        "200":
          description: Sync result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SyncResult"

  /api/netbox/sync/pull:
    post:
      tags: [NetBox]
      summary: Pull devices from NetBox
      responses:
        "200":
          description: Sync result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SyncResult"

  /api/netbox/sync/vendors/push:
    post:
      tags: [NetBox]
      summary: Push vendors to NetBox
      responses:
        "200":
          description: Sync result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SyncResult"

  /api/netbox/sync/vendors/pull:
    post:
      tags: [NetBox]
      summary: Pull vendors from NetBox
      responses:
        "200":
          description: Sync result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SyncResult"

  /api/netbox/manufacturers:
    get:
      tags: [NetBox]
      summary: List NetBox manufacturers
      responses:
        "200":
          description: Manufacturers
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/NetBoxItem"

  /api/netbox/sites:
    get:
      tags: [NetBox]
      summary: List NetBox sites
      responses:
        "200":
          description: Sites
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/NetBoxItem"

  /api/netbox/device-roles:
    get:
      tags: [NetBox]
      summary: List NetBox device roles
      responses:
        "200":
          description: Device roles
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/NetBoxItem"

  # ── Settings & Branding ─────────────────────────────────────────
  /api/settings:
    get:
      tags: [Settings]
      summary: Get global settings
      responses:
        "200":
          description: Current settings
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Settings"
    put:
      tags: [Settings]
      summary: Update settings
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Settings"
      responses:
        "200":
          description: Updated settings
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Settings"

  /api/reload:
    post:
      tags: [Settings]
      summary: Reload DHCP/TFTP configuration
      responses:
        "200":
          $ref: "#/components/responses/Message"

  /api/network/addresses:
    get:
      tags: [Settings]
      summary: List local network interfaces
      responses:
        "200":
          description: Network interfaces
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/NetworkInterface"

  /api/branding:
    get:
      tags: [Settings]
      summary: Get branding info (public)
      security: []
      responses:
        "200":
          description: Branding info
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Branding"

  /api/branding/logo:
    get:
      tags: [Settings]
      summary: Get logo image (public)
      security: []
      responses:
        "200":
          description: Logo image
          content:
            image/*:
              schema:
                type: string
                format: binary
        "404":
          $ref: "#/components/responses/NotFound"
    post:
      tags: [Settings]
      summary: Upload logo
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        "200":
          $ref: "#/components/responses/Message"
    delete:
      tags: [Settings]
      summary: Delete logo
      responses:
        "200":
          $ref: "#/components/responses/Message"

  # ── WebSocket ───────────────────────────────────────────────────
  /api/ws:
    get:
      tags: [Settings]
      summary: WebSocket connection for real-time events
      description: |
        Upgrade to WebSocket for real-time event streaming.
        Events include device discovery, status changes, job updates, and config pulls.
      responses:
        "101":
          description: Switching Protocols (WebSocket upgrade)

  # ── Config Server ───────────────────────────────────────────────
  /configs/{filename}:
    parameters:
      - name: filename
        in: path
        required: true
        schema:
          type: string
    get:
      tags: [Devices]
      summary: Serve device configuration file (TFTP/HTTP)
      security: []
      responses:
        "200":
          description: Plain text configuration
          content:
            text/plain:
              schema:
                type: string
        "404":
          $ref: "#/components/responses/NotFound"

  # ── Benchmarks ──────────────────────────────────────────────────
  /api/benchmark:
    get:
      tags: [Benchmarks]
      summary: Simple JSON benchmark
      responses:
        "200":
          description: Benchmark result
          content:
            application/json:
              schema:
                type: object

  /api/mandelbrot:
    get:
      tags: [Benchmarks]
      summary: Mandelbrot computation benchmark
      responses:
        "200":
          description: Benchmark result with timing
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  width:
                    type: integer
                  height:
                    type: integer
                  max_iter:
                    type: integer
                  iterations:
                    type: integer
                    format: int64
                  elapsed_ms:
                    type: number

  /api/json-bench:
    get:
      tags: [Benchmarks]
      summary: JSON serialization benchmark
      responses:
        "200":
          description: Benchmark result
          content:
            application/json:
              schema:
                type: object

  /api/template-simple:
    get:
      tags: [Benchmarks]
      summary: Simple template rendering benchmark
      responses:
        "200":
          description: Benchmark result
          content:
            application/json:
              schema:
                type: object

  /api/template-large:
    get:
      tags: [Benchmarks]
      summary: Large template rendering benchmark
      responses:
        "200":
          description: Benchmark result
          content:
            application/json:
              schema:
                type: object

  /api/template-acl:
    get:
      tags: [Benchmarks]
      summary: ACL template benchmark (1000 terms)
      responses:
        "200":
          description: Benchmark result
          content:
            application/json:
              schema:
                type: object

  /api/template-acl10k:
    get:
      tags: [Benchmarks]
      summary: ACL template benchmark (10000 terms)
      responses:
        "200":
          description: Benchmark result
          content:
            application/json:
              schema:
                type: object

# ══════════════════════════════════════════════════════════════════
# Components
# ══════════════════════════════════════════════════════════════════
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    DeviceId:
      name: id
      in: path
      required: true
      schema:
        type: integer
        format: int64
      description: Device ID (integer)

    Id:
      name: id
      in: path
      required: true
      schema:
        type: integer
        format: int64

    IntId:
      name: id
      in: path
      required: true
      schema:
        type: integer
        format: int64

    Limit:
      name: limit
      in: query
      schema:
        type: integer
        default: 100
        minimum: 1
        maximum: 1000

    Offset:
      name: offset
      in: query
      schema:
        type: integer
        default: 0
        minimum: 0

  responses:
    Message:
      description: Success message
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/MessageResponse"

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

    Unauthorized:
      description: Invalid or missing credentials
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

    Conflict:
      description: Resource already exists
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

  schemas:
    # ── Common ──────────────────────────────────────────────────
    MessageResponse:
      type: object
      required: [message]
      properties:
        message:
          type: string

    ErrorResponse:
      type: object
      required: [error]
      properties:
        error:
          type: string

    # ── Auth ────────────────────────────────────────────────────
    LoginRequest:
      type: object
      required: [username, password]
      properties:
        username:
          type: string
        password:
          type: string

    LoginResponse:
      type: object
      required: [token, username]
      properties:
        token:
          type: string
        username:
          type: string

    # ── Device ──────────────────────────────────────────────────
    Device:
      type: object
      required: [id, ip, hostname, config_template, status, device_type, created_at, updated_at]
      properties:
        id:
          type: integer
          format: int64
        mac:
          type: string
        ip:
          type: string
        hostname:
          type: string
        vendor:
          type: string
        model:
          type: string
        serial_number:
          type: string
        config_template:
          type: string
        ssh_user:
          type: string
        ssh_pass:
          type: string
        topology_id:
          type: integer
          format: int64
        topology_role:
          type: string
        hall_id:
          type: integer
          format: int64
        row_id:
          type: integer
          format: int64
        rack_id:
          type: integer
          format: int64
        rack_position:
          type: integer
        device_type:
          type: string
          enum: [internal, external, host]
        status:
          $ref: "#/components/schemas/DeviceStatus"
        last_seen:
          type: string
          format: date-time
        last_backup:
          type: string
          format: date-time
        last_error:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    DeviceStatus:
      type: string
      enum: [online, offline, provisioning, unknown]

    CreateDeviceRequest:
      type: object
      required: [ip, hostname]
      properties:
        mac:
          type: string
        ip:
          type: string
        hostname:
          type: string
        vendor:
          type: string
        model:
          type: string
        serial_number:
          type: string
        config_template:
          type: string
        ssh_user:
          type: string
        ssh_pass:
          type: string
        topology_id:
          type: integer
          format: int64
        topology_role:
          type: string
        device_type:
          type: string
          enum: [internal, external, host]

    UpdateDeviceRequest:
      type: object
      required: [ip, hostname]
      properties:
        mac:
          type: string
        ip:
          type: string
        hostname:
          type: string
        vendor:
          type: string
        model:
          type: string
        serial_number:
          type: string
        config_template:
          type: string
        ssh_user:
          type: string
        ssh_pass:
          type: string
        topology_id:
          type: integer
          format: int64
        topology_role:
          type: string
        device_type:
          type: string
          enum: [internal, external, host]

    ConnectResult:
      type: object
      required: [ping, ssh, success]
      properties:
        ping:
          type: object
          required: [reachable]
          properties:
            reachable:
              type: boolean
            latency:
              type: string
            error:
              type: string
        ssh:
          type: object
          required: [connected]
          properties:
            connected:
              type: boolean
            uptime:
              type: string
            hostname:
              type: string
            version:
              type: string
            interfaces:
              type: string
            error:
              type: string
        success:
          type: boolean

    ConnectIpRequest:
      type: object
      required: [ip]
      properties:
        ip:
          type: string
        vendor:
          type: string
        ssh_user:
          type: string
        ssh_pass:
          type: string

    DeviceConfigResponse:
      type: object
      required: [hostname, filename, content, exists]
      properties:
        hostname:
          type: string
        filename:
          type: string
        content:
          type: string
        exists:
          type: boolean

    DeviceConfigPreviewResponse:
      type: object
      required: [hostname, template_id, template_name, content]
      properties:
        hostname:
          type: string
        template_id:
          type: integer
          format: int64
        template_name:
          type: string
        content:
          type: string

    ExecRequest:
      type: object
      required: [command]
      properties:
        command:
          type: string

    # ── Device Variables ────────────────────────────────────────
    DeviceVariable:
      type: object
      required: [id, device_id, key, value, created_at, updated_at]
      properties:
        id:
          type: integer
        device_id:
          type: integer
          format: int64
        key:
          type: string
        value:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    SetVariablesRequest:
      type: object
      required: [variables]
      properties:
        variables:
          type: object
          additionalProperties:
            type: string

    SetVariableRequest:
      type: object
      required: [value]
      properties:
        value:
          type: string

    VariableKeyInfo:
      type: object
      required: [key, device_count]
      properties:
        key:
          type: string
        device_count:
          type: integer
          format: int64

    BulkSetRequest:
      type: object
      required: [entries]
      properties:
        entries:
          type: array
          items:
            type: object
            required: [device_id, key, value]
            properties:
              device_id:
                type: integer
                format: int64
              key:
                type: string
              value:
                type: string

    # ── Port Assignments ────────────────────────────────────────
    PortAssignment:
      type: object
      required: [id, device_id, port_name, created_at, updated_at]
      properties:
        id:
          type: integer
          format: int64
        device_id:
          type: integer
          format: int64
        port_name:
          type: string
        remote_device_id:
          type: integer
          format: int64
        remote_port_name:
          type: string
        description:
          type: string
        patch_panel_a_id:
          type: integer
          format: int64
        patch_panel_a_port:
          type: string
        patch_panel_b_id:
          type: integer
          format: int64
        patch_panel_b_port:
          type: string
        remote_device_hostname:
          type: string
        remote_device_type:
          type: string
        patch_panel_a_hostname:
          type: string
        patch_panel_b_hostname:
          type: string
        vrf_id:
          type: integer
          format: int64
        vrf_name:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    SetPortAssignmentRequest:
      type: object
      required: [port_name]
      properties:
        port_name:
          type: string
        remote_device_id:
          type: integer
          format: int64
        remote_port_name:
          type: string
        description:
          type: string
        patch_panel_a_id:
          type: integer
          format: int64
        patch_panel_a_port:
          type: string
        patch_panel_b_id:
          type: integer
          format: int64
        patch_panel_b_port:
          type: string
        vrf_id:
          type: integer
          format: int64

    # ── Groups ──────────────────────────────────────────────────
    Group:
      type: object
      required: [id, name, precedence, created_at, updated_at]
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        parent_id:
          type: integer
          format: int64
        precedence:
          type: integer
        device_count:
          type: integer
        child_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateGroupRequest:
      type: object
      required: [name, precedence]
      properties:
        name:
          type: string
        description:
          type: string
        parent_id:
          type: integer
          format: int64
        precedence:
          type: integer

    GroupVariable:
      type: object
      required: [id, group_id, key, value, created_at, updated_at]
      properties:
        id:
          type: integer
        group_id:
          type: integer
          format: int64
        key:
          type: string
        value:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    SetMembersRequest:
      type: object
      required: [device_ids]
      properties:
        device_ids:
          type: array
          items:
            type: integer
            format: int64

    SetDeviceGroupsRequest:
      type: object
      required: [group_ids]
      properties:
        group_ids:
          type: array
          items:
            type: integer
            format: int64

    ResolvedVariablesResponse:
      type: object
      required: [variables, resolved, resolution_order]
      properties:
        variables:
          type: object
          additionalProperties:
            type: string
        resolved:
          type: array
          items:
            $ref: "#/components/schemas/ResolvedVariable"
        resolution_order:
          type: array
          items:
            $ref: "#/components/schemas/ResolutionLayer"

    ResolvedVariable:
      type: object
      required: [key, value, source, source_name, source_type]
      properties:
        key:
          type: string
        value:
          type: string
        source:
          type: string
        source_name:
          type: string
        source_type:
          type: string
          enum: [all, group, host]

    ResolutionLayer:
      type: object
      required: [source, source_name, source_type, precedence, variables]
      properties:
        source:
          type: string
        source_name:
          type: string
        source_type:
          type: string
          enum: [all, group, host]
        precedence:
          type: integer
        variables:
          type: object
          additionalProperties:
            type: string

    # ── Templates ───────────────────────────────────────────────
    Template:
      type: object
      required: [id, name, content, created_at, updated_at]
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        vendor_id:
          type: integer
          format: int64
        content:
          type: string
        device_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateTemplateRequest:
      type: object
      required: [name, content]
      properties:
        name:
          type: string
        description:
          type: string
        vendor_id:
          type: integer
          format: int64
        content:
          type: string

    TemplatePreviewRequest:
      type: object
      required: [device]
      properties:
        device:
          type: object
          required: [ip, hostname]
          properties:
            mac:
              type: string
            ip:
              type: string
            hostname:
              type: string
            vendor:
              type: string
            serial_number:
              type: string
            ssh_user:
              type: string
            ssh_pass:
              type: string
            topology_id:
              type: integer
              format: int64
            topology_role:
              type: string
        subnet:
          type: string
        gateway:
          type: string

    TemplateVariable:
      type: object
      required: [name, description, example]
      properties:
        name:
          type: string
        description:
          type: string
        example:
          type: string

    # ── Vendors ─────────────────────────────────────────────────
    Vendor:
      type: object
      required: [id, name, backup_command, deploy_command, ssh_port, mac_prefixes]
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        backup_command:
          type: string
        deploy_command:
          type: string
        ssh_port:
          type: integer
        ssh_user:
          type: string
        ssh_pass:
          type: string
        mac_prefixes:
          type: array
          items:
            type: string
        vendor_class:
          type: string
          description: DHCP Option 60 vendor class identifier
        default_template:
          type: string
        device_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateVendorRequest:
      type: object
      required: [name, backup_command, deploy_command, ssh_port, mac_prefixes]
      properties:
        name:
          type: string
        backup_command:
          type: string
        deploy_command:
          type: string
        ssh_port:
          type: integer
        ssh_user:
          type: string
        ssh_pass:
          type: string
        mac_prefixes:
          type: array
          items:
            type: string
        vendor_class:
          type: string
        default_template:
          type: string

    VendorAction:
      type: object
      required: [id, vendor_id, label, command, sort_order, action_type, created_at]
      properties:
        id:
          type: integer
          format: int64
        vendor_id:
          type: integer
          format: int64
        label:
          type: string
        command:
          type: string
        sort_order:
          type: integer
        action_type:
          type: string
          enum: [ssh, webhook]
        webhook_url:
          type: string
        webhook_method:
          type: string
          enum: [GET, POST, PUT, PATCH, DELETE]
        webhook_headers:
          type: string
          description: JSON string of headers
        webhook_body:
          type: string
          description: Request body template
        output_parser_id:
          type: integer
          format: int64
        created_at:
          type: string
          format: date-time

    CreateVendorActionRequest:
      type: object
      required: [vendor_id, label, command, sort_order, action_type]
      properties:
        vendor_id:
          type: integer
          format: int64
        label:
          type: string
        command:
          type: string
        sort_order:
          type: integer
        action_type:
          type: string
          enum: [ssh, webhook]
        webhook_url:
          type: string
        webhook_method:
          type: string
          enum: [GET, POST, PUT, PATCH, DELETE]
        webhook_headers:
          type: string
        webhook_body:
          type: string
        output_parser_id:
          type: integer
          format: int64

    # ── Device Models ───────────────────────────────────────────
    DeviceModel:
      type: object
      required: [id, vendor_id, model, display_name, rack_units, layout, created_at, updated_at]
      properties:
        id:
          type: integer
          format: int64
        vendor_id:
          type: integer
          format: int64
        model:
          type: string
        display_name:
          type: string
        rack_units:
          type: integer
        layout:
          type: string
          description: JSON string defining port layout
        device_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateDeviceModelRequest:
      type: object
      required: [vendor_id, model, display_name, rack_units, layout]
      properties:
        vendor_id:
          type: integer
          format: int64
        model:
          type: string
        display_name:
          type: string
        rack_units:
          type: integer
        layout:
          type: string

    # ── Device Roles ────────────────────────────────────────────
    DeviceRole:
      type: object
      required: [id, name, created_at, updated_at]
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        template_ids:
          type: array
          items:
            type: integer
            format: int64
        template_names:
          type: array
          items:
            type: string
        group_names:
          type: array
          items:
            type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateDeviceRoleRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        description:
          type: string
        template_ids:
          type: array
          items:
            type: integer
            format: int64

    # ── Topologies ──────────────────────────────────────────────
    Topology:
      type: object
      required: [id, name, created_at, updated_at]
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        device_count:
          type: integer
        super_spine_count:
          type: integer
        spine_count:
          type: integer
        leaf_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateTopologyRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        description:
          type: string

    # ── DHCP Options ────────────────────────────────────────────
    DhcpOption:
      type: object
      required: [id, option_number, name, value, type, enabled]
      properties:
        id:
          type: integer
          format: int64
        option_number:
          type: integer
        name:
          type: string
        value:
          type: string
        type:
          $ref: "#/components/schemas/DhcpOptionType"
        vendor_id:
          type: integer
          format: int64
          description: If set, option only applies to this vendor
        description:
          type: string
        enabled:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    DhcpOptionType:
      type: string
      enum: [string, ip, hex, number]

    CreateDhcpOptionRequest:
      type: object
      required: [option_number, name, value, type, enabled]
      properties:
        option_number:
          type: integer
        name:
          type: string
        value:
          type: string
        type:
          $ref: "#/components/schemas/DhcpOptionType"
        vendor_id:
          type: integer
          format: int64
        description:
          type: string
        enabled:
          type: boolean

    # ── Backups ─────────────────────────────────────────────────
    Backup:
      type: object
      required: [id, device_id, filename, size, created_at]
      properties:
        id:
          type: integer
          format: int64
        device_id:
          type: integer
          format: int64
        filename:
          type: string
        size:
          type: integer
          format: int64
        created_at:
          type: string
          format: date-time

    BackupWithContent:
      allOf:
        - $ref: "#/components/schemas/Backup"
        - type: object
          required: [exists]
          properties:
            exists:
              type: boolean
            content:
              type: string

    # ── Discovery ───────────────────────────────────────────────
    DiscoveredDevice:
      type: object
      required: [mac, ip, hostname, expiry_time, expires_at]
      properties:
        mac:
          type: string
        ip:
          type: string
        hostname:
          type: string
        expiry_time:
          type: integer
          format: int64
        expires_at:
          type: string
        first_seen:
          type: string
        vendor:
          type: string
        model:
          type: string
        serial_number:
          type: string
        vendor_class:
          type: string
          description: "Option 60: vendor class identifier"
        user_class:
          type: string
          description: "Option 77: user class"
        dhcp_client_id:
          type: string
          description: "Option 61: client identifier"
        requested_options:
          type: string
        relay_address:
          type: string
        circuit_id:
          type: string
          description: "Option 82.1: circuit ID"
        remote_id:
          type: string
          description: "Option 82.2: remote ID"
        subscriber_id:
          type: string
          description: "Option 82.6: subscriber ID"

    DiscoveryLog:
      type: object
      required: [id, event_type, mac, ip, created_at]
      properties:
        id:
          type: integer
        event_type:
          type: string
          enum: [discovered, added, lease_renewed, lease_expired]
        mac:
          type: string
        ip:
          type: string
        hostname:
          type: string
        vendor:
          type: string
        message:
          type: string
        created_at:
          type: string
          format: date-time

    # ── Jobs ────────────────────────────────────────────────────
    Job:
      type: object
      required: [id, job_type, device_id, command, status, created_at]
      properties:
        id:
          type: string
        job_type:
          type: string
          enum: [command, deploy, diff]
        device_id:
          type: integer
          format: int64
        command:
          type: string
        status:
          type: string
          enum: [queued, running, completed, failed]
        output:
          type: string
        error:
          type: string
        created_at:
          type: string
          format: date-time
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time

    # ── Job Templates ───────────────────────────────────────────
    JobTemplate:
      type: object
      required: [id, name, description, job_type, command, target_mode, enabled, created_at, updated_at]
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        job_type:
          type: string
        command:
          type: string
        action_id:
          type: integer
          format: int64
        target_mode:
          type: string
          enum: [devices, group]
        target_device_ids:
          type: array
          items:
            type: integer
            format: int64
        target_group_id:
          type: integer
          format: int64
        schedule:
          type: string
          description: Cron expression
        enabled:
          type: boolean
        credential_id:
          type: integer
          format: int64
        last_run_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateJobTemplateRequest:
      type: object
      required: [name, job_type, command, target_mode]
      properties:
        name:
          type: string
        description:
          type: string
        job_type:
          type: string
        command:
          type: string
        action_id:
          type: integer
          format: int64
        target_mode:
          type: string
          enum: [devices, group]
        target_device_ids:
          type: array
          items:
            type: integer
            format: int64
        target_group_id:
          type: integer
          format: int64
        schedule:
          type: string
        enabled:
          type: boolean
        credential_id:
          type: integer
          format: int64

    # ── Credentials ─────────────────────────────────────────────
    Credential:
      type: object
      required: [id, name, cred_type, username, created_at, updated_at]
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        cred_type:
          type: string
        username:
          type: string
        password:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateCredentialRequest:
      type: object
      required: [name, cred_type, username, password]
      properties:
        name:
          type: string
        description:
          type: string
        cred_type:
          type: string
        username:
          type: string
        password:
          type: string

    # ── Output Parsers ──────────────────────────────────────────
    OutputParser:
      type: object
      required: [id, name, pattern, extract_names, enabled, created_at, updated_at]
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        pattern:
          type: string
          description: Regex pattern for extraction
        extract_names:
          type: string
          description: Comma-separated capture group names
        enabled:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateOutputParserRequest:
      type: object
      required: [name, pattern, extract_names, enabled]
      properties:
        name:
          type: string
        description:
          type: string
        pattern:
          type: string
        extract_names:
          type: string
        enabled:
          type: boolean

    # ── Users ───────────────────────────────────────────────────
    User:
      type: object
      required: [id, username, enabled, created_at, updated_at]
      properties:
        id:
          type: integer
          format: int64
        username:
          type: string
        enabled:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateUserRequest:
      type: object
      required: [username, password]
      properties:
        username:
          type: string
        password:
          type: string
        enabled:
          type: boolean

    # ── Docker ──────────────────────────────────────────────────
    TestContainer:
      type: object
      required: [id, name, hostname, mac, ip, status, created_at]
      properties:
        id:
          type: string
        name:
          type: string
        hostname:
          type: string
        mac:
          type: string
        ip:
          type: string
        status:
          type: string
        created_at:
          type: string
          format: date-time

    SpawnContainerRequest:
      type: object
      properties:
        hostname:
          type: string
        mac:
          type: string
        vendor_class:
          type: string
          description: DHCP Option 60 vendor class identifier
        config_method:
          type: string
          enum: [tftp, http, both]
        image:
          type: string
          description: Docker image to use
        topology_id:
          type: integer
          format: int64
        topology_role:
          type: string

    VirtualClosRequest:
      type: object
      properties:
        spines:
          type: integer
          description: Number of spine switches
        leaves:
          type: integer
          description: Number of leaf switches
        region_id:
          type: integer
          format: int64
        campus_id:
          type: integer
          format: int64
        datacenter_id:
          type: integer
          format: int64
        halls:
          type: integer
        rows_per_hall:
          type: integer
        racks_per_row:
          type: integer
        leaves_per_rack:
          type: integer
        external_devices:
          type: integer
        uplinks_per_spine:
          type: integer
        external_names:
          type: array
          items:
            type: string
        spawn_containers:
          type: boolean
        ceos_image:
          type: string

    ClosLabResponse:
      type: object
      required: [topology_id, topology_name, devices, fabric_links]
      properties:
        topology_id:
          type: integer
          format: int64
        topology_name:
          type: string
        devices:
          type: array
          items:
            type: object
            required: [hostname, role, ip]
            properties:
              hostname:
                type: string
              role:
                type: string
              mac:
                type: string
              ip:
                type: string
              container_name:
                type: string
        fabric_links:
          type: array
          items:
            type: string

    # ── IPAM ────────────────────────────────────────────────────
    IpamStatus:
      type: string
      enum: [active, reserved, deprecated, dhcp]

    IpamRegion:
      type: object
      required: [id, name, created_at, updated_at]
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        campus_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateIpamRegionRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        description:
          type: string

    IpamCampus:
      type: object
      required: [id, name, region_id, created_at, updated_at]
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        region_id:
          type: integer
          format: int64
        region_name:
          type: string
        datacenter_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateIpamCampusRequest:
      type: object
      required: [name, region_id]
      properties:
        name:
          type: string
        description:
          type: string
        region_id:
          type: integer
          format: int64

    IpamDatacenter:
      type: object
      required: [id, name, campus_id, created_at, updated_at]
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        campus_id:
          type: integer
          format: int64
        campus_name:
          type: string
        region_name:
          type: string
        hall_count:
          type: integer
        prefix_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateIpamDatacenterRequest:
      type: object
      required: [name, campus_id]
      properties:
        name:
          type: string
        description:
          type: string
        campus_id:
          type: integer
          format: int64

    IpamHall:
      type: object
      required: [id, name, datacenter_id, created_at, updated_at]
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        datacenter_id:
          type: integer
          format: int64
        datacenter_name:
          type: string
        row_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateIpamHallRequest:
      type: object
      required: [name, datacenter_id]
      properties:
        name:
          type: string
        description:
          type: string
        datacenter_id:
          type: integer
          format: int64

    IpamRow:
      type: object
      required: [id, name, hall_id, created_at, updated_at]
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        hall_id:
          type: integer
          format: int64
        hall_name:
          type: string
        rack_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateIpamRowRequest:
      type: object
      required: [name, hall_id]
      properties:
        name:
          type: string
        description:
          type: string
        hall_id:
          type: integer
          format: int64

    IpamRack:
      type: object
      required: [id, name, row_id, created_at, updated_at]
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        row_id:
          type: integer
          format: int64
        row_name:
          type: string
        device_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateIpamRackRequest:
      type: object
      required: [name, row_id]
      properties:
        name:
          type: string
        description:
          type: string
        row_id:
          type: integer
          format: int64

    IpamRole:
      type: object
      required: [id, name, created_at]
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        created_at:
          type: string
          format: date-time

    CreateIpamRoleRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        description:
          type: string

    IpamVrf:
      type: object
      required: [id, name, created_at, updated_at]
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        rd:
          type: string
          description: Route Distinguisher
        description:
          type: string
        prefix_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateIpamVrfRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        rd:
          type: string
        description:
          type: string

    IpamPrefix:
      type: object
      required: [id, prefix, network_int, broadcast_int, prefix_length, status, is_supernet, created_at, updated_at]
      properties:
        id:
          type: integer
          format: int64
        prefix:
          type: string
          description: CIDR notation (e.g. 10.0.0.0/24)
        network_int:
          type: integer
          format: int64
        broadcast_int:
          type: integer
          format: int64
        prefix_length:
          type: integer
        description:
          type: string
        status:
          $ref: "#/components/schemas/IpamStatus"
        is_supernet:
          type: boolean
        role_ids:
          type: array
          items:
            type: integer
            format: int64
        role_names:
          type: array
          items:
            type: string
        parent_id:
          type: integer
          format: int64
        parent_prefix:
          type: string
        datacenter_id:
          type: integer
          format: int64
        datacenter_name:
          type: string
        vlan_id:
          type: integer
        vrf_id:
          type: integer
          format: int64
        vrf_name:
          type: string
        child_prefix_count:
          type: integer
        ip_address_count:
          type: integer
        utilization:
          type: number
          format: float
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateIpamPrefixRequest:
      type: object
      required: [prefix, status]
      properties:
        prefix:
          type: string
        description:
          type: string
        status:
          $ref: "#/components/schemas/IpamStatus"
        is_supernet:
          type: boolean
        role_ids:
          type: array
          items:
            type: integer
            format: int64
        parent_id:
          type: integer
          format: int64
        datacenter_id:
          type: integer
          format: int64
        vlan_id:
          type: integer
        vrf_id:
          type: integer
          format: int64

    IpamIpAddress:
      type: object
      required: [id, address, address_int, prefix_id, status, created_at, updated_at]
      properties:
        id:
          type: integer
          format: int64
        address:
          type: string
        address_int:
          type: integer
          format: int64
        prefix_id:
          type: integer
          format: int64
        prefix:
          type: string
        description:
          type: string
        status:
          $ref: "#/components/schemas/IpamStatus"
        role_ids:
          type: array
          items:
            type: integer
            format: int64
        role_names:
          type: array
          items:
            type: string
        dns_name:
          type: string
        device_id:
          type: integer
          format: int64
        device_hostname:
          type: string
        interface_name:
          type: string
        vrf_id:
          type: integer
          format: int64
        vrf_name:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateIpamIpAddressRequest:
      type: object
      required: [address, prefix_id, status]
      properties:
        address:
          type: string
        prefix_id:
          type: integer
          format: int64
        description:
          type: string
        status:
          $ref: "#/components/schemas/IpamStatus"
        role_ids:
          type: array
          items:
            type: integer
            format: int64
        dns_name:
          type: string
        device_id:
          type: integer
          format: int64
        interface_name:
          type: string
        vrf_id:
          type: integer
          format: int64

    IpamTag:
      type: object
      required: [id, resource_type, resource_id, key, value, created_at]
      properties:
        id:
          type: integer
        resource_type:
          type: string
        resource_id:
          type: string
        key:
          type: string
        value:
          type: string
        created_at:
          type: string
          format: date-time

    # ── NetBox ──────────────────────────────────────────────────
    NetBoxStatus:
      type: object
      required: [configured, connected]
      properties:
        configured:
          type: boolean
        connected:
          type: boolean
        url:
          type: string
        sync_enabled:
          type: boolean

    NetBoxConfig:
      type: object
      properties:
        url:
          type: string
        token:
          type: string
        site_id:
          type: string
        role_id:
          type: string
        sync_enabled:
          type: boolean

    SyncResult:
      type: object
      properties:
        created:
          type: integer
        updated:
          type: integer
        deleted:
          type: integer
        errors:
          type: array
          items:
            type: string

    NetBoxItem:
      type: object
      required: [id, name]
      properties:
        id:
          type: integer
        name:
          type: string
        slug:
          type: string

    # ── Settings ────────────────────────────────────────────────
    Settings:
      type: object
      required:
        - default_ssh_user
        - default_ssh_pass
        - backup_command
        - backup_delay
        - dhcp_range_start
        - dhcp_range_end
        - dhcp_subnet
        - dhcp_gateway
        - tftp_server_ip
        - hostname_pattern
      properties:
        default_ssh_user:
          type: string
        default_ssh_pass:
          type: string
        backup_command:
          type: string
        backup_delay:
          type: integer
        dhcp_range_start:
          type: string
        dhcp_range_end:
          type: string
        dhcp_subnet:
          type: string
        dhcp_gateway:
          type: string
        tftp_server_ip:
          type: string
        opengear_enroll_url:
          type: string
        opengear_enroll_bundle:
          type: string
        opengear_enroll_password:
          type: string
        app_name:
          type: string
          description: Custom application name for branding
        logo_url:
          type: string
          description: URL of uploaded logo
        hostname_pattern:
          type: string
          description: "Pattern for auto-generated hostnames. Variables: $datacenter, $role, # (auto-increment)"
          default: "$datacenter-$role-#"

    Branding:
      type: object
      properties:
        app_name:
          type: string
        logo_url:
          type: string

    NetworkInterface:
      type: object
      required: [name, addresses, is_up, is_loopback]
      properties:
        name:
          type: string
        addresses:
          type: array
          items:
            type: string
        is_up:
          type: boolean
        is_loopback:
          type: boolean
